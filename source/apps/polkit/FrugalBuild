# Compiling Time: 0.14 SBU
# Maintainer: bouleetbil <bouleetbil@frogdev.info>

pkgname=polkit
pkgver=0.101
pkgrel=3
pkgdesc="Policy framework for controlling privileges for system-wide services"
url="http://hal.freedesktop.org/docs/PolicyKit"
depends=('pam' 'dbus-glib' 'expat' 'eggdbus')
makedepends=('intltool' 'gobject-introspection>=0.9.0' 'docbook-xsl')
groups=('apps')
archs=('i686' 'x86_64' 'ppc' 'arm')
up2date="Flasttar http://hal.freedesktop.org/releases/"
source=(http://hal.freedesktop.org/releases/$pkgname-$pkgver.tar.gz \
	0001-PolkitUnixProcess-Clarify-that-the-real-uid-is-retur.patch \
	0002-Make-PolkitUnixProcess-also-record-the-uid-of-the-pr.patch \
	0003-Use-polkit_unix_process_get_uid-to-get-the-owner-of-.patch \
	0004-pkexec-Avoid-TOCTTOU-problems-with-parent-process.patch)
sha1sums=('9d1f58a99d40889ceebbde142f93c305471fc151' \
          '6824496f96d23e7b2db96a6fcf0ab715c2faa4f0' \
          '0942dcab9c09909a3c6d86f565359dcc80ba895c' \
          '2805ee357890ac7aaa536c05e4be97b4936a6c90' \
          '6ae3f4a9f1dd86dce927281def82ab477ddd847b')

replaces=('policykit')
conflicts=('policykit')
options=('scriptlet')

build() {
	Fbuild --with-authdb=default --with-authfw=pam --with-os-type=FrugalWare \
	--disable-selinux
	Fcp $pkgname-$pkgver/src/polkitagent/polkitagentenumtypes.h usr/include/polkit-1/polkitagent/

###
### BEGIN DESKTOP POLICY CONFIGURATION ###
###

cat > $Fdestdir/etc/polkit-1/localauthority.conf.d/60-desktop-policy.conf << EOF
# This allows users in the wheel group to authenticate as the
# administrator.
#
# DO NOT EDIT THIS FILE, it will be overwritten on update.

[Configuration]
AdminIdentities=unix-group:wheel
EOF

cat > $Fdestdir/var/lib/polkit-1/localauthority/10-vendor.d/10-desktop-policy.pkla << EOF
# Authorizations/policy for the wheel group.
#
# DO NOT EDIT THIS FILE, it will be overwritten on update.
#
# Allow users in the wheel group to do certain actions without being
# interrupted by password dialogs
#
[Wheel Group Permissions]
Identity=unix-group:wheel
Action=org.gnome.settingsdaemon.datetimemechanism.*;org.kde.kcontrol.kcmclock.save;org.freedesktop.RealtimeKit1.*;org.freedesktop.udisks.filesystem-mount-system-internal;org.freedesktop.hostname1.set-static-hostname
ResultAny=auth_admin
ResultInactive=auth_admin
ResultActive=yes
EOF

###
### END DESKTOP POLICY CONFIGURATION
###

}

# optimization OK
