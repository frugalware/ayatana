# Compiling Time: 25.85 SBU
# Maintainer: centuri0 <achevaux at gmail dot com>

pkgname=kdelibs
pkgrel=2
pkgdesc="KDE4 Core Libraries."
groups=('kde')
replaces=('kat')
archs=('i686' 'x86_64' 'ppc')
_F_kde_subpkgs_custom_path=1
Finclude kde
depends=()
## for now
makedepends=("${makedepends[@]}" "krb5" "libqttest>=$_F_kde_qtver" \
	"shared-desktop-ontologies>=0.5" \
	"libqtdeclarative>=$_F_kde_qtver")
source=($source \
	frugalware-menu.patch \
	FrugalBuild-syntax-highlight.patch \
	kde-applications-menu.patch)
sha1sums=('9bb948769a3a5d4d5b6c65e84a8cf570bd7bc120' \
          'c657c474875c155197dde1c846f1791e744febc2' \
          'd68e789167fb028a9da7d4d5393a363ad56b0c6f' \
          '86ee8c8660f19de8141ac99cd6943964d97a1ed7')

## conflicts kdebase-workspace<=4.3.5

## Qt4 like :)

DNSSDDEP="libdnssd>=$_F_kde_ver"
KATEDEP="libkdekate>=$_F_kde_ver"
KDE3SUPPORTDEP="libkde3support>=$_F_kde_ver"
KDECOREDEP="libkdecore>=$_F_kde_ver"
KDESUDEP="libkdesu>=$_F_kde_ver"
WEBKITDEP="libkdewebkit>=$_F_kde_ver"
KFILEDEP="libkfile>=$_F_kde_ver"
KHTMLDEP="libkhtml>=$_F_kdever"
KNEWDEP="libknewstuff>=$_F_kde_ver"
KNOTITYDEP="libknotify>=$_F_kde_ver"
KROSSDEP="libkross>=$_F_kde_ver"
KUTILSDEP="libkutils>=$_F_kde_ver"
NEPOMUKDEP="libnepomuk>=$_F_kde_ver"
PLASMADEP="libplasma>=$_F_kde_ver"
THREADWDEP="libthreadweaver>=$_F_kde_ver"

PHONONDEP="phonon>=4.4.0-2"
POLKIT_QT_1DEP="polkit-qt-1>=0.99.0"

Qt4="$_F_kde_qtver"

##################################
## auto-split magic starts here ##
##################################


subpkgs=("${subpkgs[@]}" "libkde3support")
subdescs=("${subdescs[@]}" "Libraries to support KDE3 code.")
subdepends=("${subdepends[@]}" "libqtcore>=$Qt4 libqtdbus>=$Qt4 libqt3support>=$Qt4 libqtsvg>=$Qt4
	$POLKIT_QT_1DEP gamin xfsprogs-attr libsm libxcursor libpng fontconfig libxi")
subrodepends=("${subrodepends[@]}" "$KDECOREDEP $KDESUDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libplasma")
subdescs=("${subdescs[@]}" "Framework for the KDE desktop shell and its widgets.")
subdepends=("${subdepends[@]}" "libqtuitools>=$Qt4 libqtwebkit>=$Qt4 libqtopengl>=$Qt4
	qca gamin xfsprogs-attr libqtdbus libxcb libxdamage $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDECOREDEP $KNEWDEP $THREADWDEP $DNSSDDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libnepomuk")
subdescs=("${subdescs[@]}" "Semantic information retrieval and tagging.")
subdepends=("${subdepends[@]}" "libqtdbus>=$Qt4 libqtgui>=$Qt4 soprano>=2.5.3 bzip2 $POLKIT_QT_1DEP libxext shared-desktop-ontologies")
subrodepends=("${subrodepends[@]}" "$KDECOREDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libdnssd")
subdescs=("${subdescs[@]}" "Interface to support the DNS-SD (Zeroconf) protocol.")
subdepends=("${subdepends[@]}" "libqtdbus>=$Qt4 libqtgui>=$Qt4 bzip2 libxext $POLKIT_QT_1DEP avahi")
subrodepends=("${subrodepends[@]}" "$KDECOREDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libknotify")
subdescs=("${subdescs[@]}" "User Notification Libraries.")
subdepends=("${subdepends[@]}" "$PHONONDEP gamin xfsprogs-attr bzip2 libxext $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDECOREDEP phonon-backend-vlc")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libkross")
subdescs=("${subdescs[@]}" "Scripting Libraries.")
subdepends=("${subdepends[@]}" "libqtcore>=$Qt4 libqtsvg>=$Qt4 libqtdbus>=$Qt4 libqtdesigner>=$Qt4
	gamin xfsprogs-attr libpng fontconfig libxi $POLKIT_QT_1DEP libsm libxcursor")
subrodepends=("${subrodepends[@]}" "$KDECOREDEP $KFILEDEP libkjsembed>=$_F_kde_ver")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libkdewebkit")
subdescs=("${subdescs[@]}" "KDE WebKit Library")
subdepends=("${subdepends[@]}" "libqtwebkit>=$Qt4 libqtgui>=$Qt4 libqtdbus>=$Qt4 gamin xfsprogs-attr bzip2 libxext libxcb $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDECOREDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libkhtml")
subdescs=("${subdescs[@]}" "HTML rendering widget designed for Konqueror.")
subdepends=("${subdepends[@]}" "libqtgui>=$Qt4 libqtdbus>=$Qt4 libjpeg>=8a libgif pcre libxcb gamin xfsprogs-attr libxext bzip2 $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDECOREDEP kdelibs-interfaces>=$_F_kde_ver")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libkfile")
subdescs=("${subdescs[@]}" "File management widgets and dialogs libraries.")
subdepends=("${subdepends[@]}" "libqtgui>=$Qt4 libqtdbus>=$Qt4 gamin xfsprogs-attr bzip2 libxext $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDECOREDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libknewstuff")
subdescs=("${subdescs[@]}" "Allows applications to easily download data from the Internet.")
subdepends=("${subdepends[@]}" "libqtgui>=$Qt4 libqtdbus>=$Qt4 gamin xfsprogs-attr bzip2 libxext $POLKIT_QT_1DEP attica>=0.1.2")
subrodepends=("${subrodepends[@]}" "$KDECOREDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libkdewidgets")
subdescs=("${subdescs[@]}" "KDE custom widgets for Qt Designer.")
subdepends=("${subdepends[@]}" "libqtgui>=$Qt4 libqtnetwork>=$Qt4 libqtdbus>=$Qt4 libqtsql>=$Qt4
	libstdc++ zlib strigi>=0.7.2 xfsprogs-acl libxrender libice libxext $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDECOREDEP $KDESUDEP $KDE3SUPPORTDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libkjsembed")
subdescs=("${subdescs[@]}" "ECMAScript bindings libraries.")
subdepends=("${subdepends[@]}" "libqtuitools>=$Qt4 libqtdbus>=$Qt4 bzip2 libx11 $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDECOREDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libkutils")
subdescs=("${subdescs[@]}" "Utility library for printing, chatting and more.")
subdepends=("${subdepends[@]}" "libqtdbus>=$Qt4 libqtgui>=$Qt4 libxscrnsaver gamin xfsprogs-attr bzip2 $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDECOREDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libthreadweaver")
subdescs=("${subdescs[@]}" "Job-based threading library.")
subdepends=("${subdepends[@]}" "libqtcore>=$Qt4 libgcc")
subrodepends=("${subrodepends[@]}" "")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libkimgio")
subdescs=("${subdescs[@]}" "Gimgio class extension libraries.")
subdepends=("${subdepends[@]}" "libqtgui>=$Qt4 libqtdbus>=$Qt4 jasper libxext bzip2 $POLKIT_QT_1DEP openexr>=1.6.1")
subrodepends=("${subrodepends[@]}" "$KDECOREDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libkunitconversion")
subdescs=("${subdescs[@]}" "KDE Unit conversation library.")
subdepends=("${subdepends[@]}" "libqtdbus>=$Qt4 libqtgui>=$Qt4 bzip2 libxext $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDECOREDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

_F_kde_subpkgs=("${subpkgs[@]}")

#################################
## auto-split magic stops here ##
#################################

## we have to rename it to libkdekate since there is already libkate in the repos
subpkgs=("${subpkgs[@]}" "libkdekate")
subdescs=("${subdescs[@]}" "KPart for Kate (KDE Advanced Text Editor).")
subdepends=("${subdepends[@]}" "libqtgui>=$Qt4 libqtdbus>=$Qt4 libqtscript>=$Qt4 gamin xfsprogs-attr bzip2 libxext $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDECOREDEP $KUTILSDEP kdelibs-interfaces>=$_F_kde_ver")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "ksgmltools2")
subdescs=("${subdescs[@]}" "KDE doc tools.")
subdepends=("${subdepends[@]}" "libqtgui>=$Qt4 libqtdbus>=$Qt4 docbook-xsl libxslt bzip2 gamin xfsprogs-attr libxext $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDECOREDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

## maybe split more ? interfces/<foo> ? worth doing that ?
subpkgs=("${subpkgs[@]}" "$pkgname-interfaces")
subdescs=("${subdescs[@]}" "Kparts interface for text editors, mediaplayer and scripting.")
subdepends=("${subdepends[@]}" "gamin xfsprogs-attr bzip2 libxext $POLKIT_QT_1DEP $PHONONDEP")
subrodepends=("${subrodepends[@]}" "$KDECOREDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

## this need kpty
subpkgs=("${subpkgs[@]}" "libkdesu")
subdescs=("${subdescs[@]}" "Library for password entering and handling.")
subdepends=("${subdepends[@]}" "libqtcore>=$Qt4 libqtdbus>=$Qt4 bzip2 $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDECOREDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

######## libkdecore / libkdecore-data ###############
## projects in here:                               ##
## kinit , kdecore , kded , cmake , includes       ##
## kconf_update , kio , kioslave , interfaces/kio  ##
## mimetypes , licenses , solid, kdeui, kjs, solid ##
#####################################################


## WARNING : DO NOT REMOVE *kparts , kdeui , kjs , solid*
## from here since these create weird circular depends() -- crazy -- ( KDE 4.4 )
## FIXME!!

subpkgs=("${subpkgs[@]}" "libkdecore")
subdescs=("${subdescs[@]}" "KDE4 Core Library.")
subdepends=("${subdepends[@]}" "libqtnetwork>=$Qt4 pcre xz $POLKIT_QT_1DEP \
	libdbusmenu-qt>=0.7.0 libgcc strigi>=0.7.2-2 xfsprogs-acl libxrender libice \
	libxtst libxfixes libuuid libkrb5 shared-mime-info udev udisks upower")
subrodepends=("${subrodepends[@]}" "")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

##FIXME!!! what to do with these ?
subpkgs=("${subpkgs[@]}" "libkdecore-data")
subdescs=("${subdescs[@]}" "Data files ( desktop files , protocol files , man , icons).")
subdepends=("${subdepends[@]}" "")
subrodepends=("${subrodepends[@]}" "")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

rodepends=("${rodepends[@]}" "${subpkgs[@]}")

subpkgs=("${subpkgs[@]}" "$pkgname-docs")
subdescs=("${subdescs[@]}" "Kelibs Documentation")
subdepends=("${subdepends[@]}" "")
subrodepends=("${subrodepends[@]}" "")
subgroups=("${subgroups[@]}" 'docs-extra kde-docs')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "$pkgname-compiletime")
subdescs=("${subdescs[@]}" "Kdelibs extra headers, cmake and pkgconfig files")
subdepends=("${subdepends[@]}" "")
subrodepends=("${subrodepends[@]}" "")
subgroups=("${subgroups[@]}" 'devel-extra kde-build')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "sonnet-plugin-hspell")
subdescs=("${subdescs[@]}" "Natural language processing for hspell")
subdepends=("${subdepends[@]}" "libqtcore>=$Qt4 libqtdbus>=$Qt4 bzip2 $POLKIT_QT_1DEP hspell")
subrodepends=("${subrodepends[@]}" "$KDECOREDEP")
subgroups=("${subgroups[@]}" 'kde-extra')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "sonnet-plugin-aspell")
subdescs=("${subdescs[@]}" "Natural language processing for aspell")
subdepends=("${subdepends[@]}" "libqtcore>=$Qt4 libqtdbus>=$Qt4 aspell bzip2 $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDECOREDEP")
subgroups=("${subgroups[@]}" 'kde-extra')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "sonnet-plugin-enchant")
subdescs=("${subdescs[@]}" "Natural language processing for enchant")
subdepends=("${subdepends[@]}" "libqtcore>=$Qt4 libqtdbus>=$Qt4 enchant bzip2 $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDECOREDEP")
subgroups=("${subgroups[@]}" 'kde-extra')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

build()
{
	Fcd
	## First some magic -- FIXME: need patch-$arch ..
	sed -i -e 's|KDE_VERSION_STRING.*|KDE_VERSION_STRING "(KDE ${KDE_VERSION}) Frugalware Linux")|g' CMakeLists.txt || Fdie
	KDE_make_split

	## ksgmltools2
	KDE_project_split ksgmltools2 kdoctools
	## kate
	KDE_project_install kate
	Fsplit libkdekate /\*

	## sonnet-plugins
	KDE_project_split sonnet-plugin-hspell  sonnet/plugins/hspell
	KDE_project_split sonnet-plugin-aspell  sonnet/plugins/aspell
	KDE_project_split sonnet-plugin-enchant sonnet/plugins/enchant

	## libkdesu
	KDE_project_install kdesu
	KDE_project_install kpty
	Fsplit libkdesu /\*

	## -interfaces
	KDE_project_install  interfaces/khexedit
	KDE_project_install  interfaces/kimproxy
	KDE_project_install  interfaces/kmediaplayer
	KDE_project_install  interfaces/kregexpeditor
	KDE_project_install  interfaces/kspeech
	KDE_project_install  interfaces/ktexteditor
	KDE_project_install  interfaces/terminal
	Fsplit $pkgname-interfaces /\*

	#####  likdecore / libkdecore-data start  #######
	KDE_project_install kdecore
	KDE_project_install kinit
	KDE_project_install kded
	KDE_project_install kconf_update
	KDE_project_install kio
	KDE_project_install kioslave
	KDE_project_install interfaces/kio
	KDE_project_install licenses
	KDE_project_install mimetypes
	KDE_project_install kjs
	KDE_project_install kdeui
	KDE_project_install kparts
	KDE_project_install solid

	## KDEUI has 2 icon folders ? hmm ? what for ?
        ## And why do we need desktop files for the libs ? .protocol files ? colors ???
        ## These are kdebase-runtime files ? no ?:) I'm lost :-D

	## OK -data subpackage -> man pages
	KDE_project_install doc
	Frm usr/share/doc
	Finstallrel 644 ./cmake/modules/*.1 /usr/share/man/man1/

	KDE_cleanup

	Fsplit libkdecore-data usr/share/apps/kdeui/about
	Fsplit libkdecore-data usr/share/apps/kdeui/pics
	Fsplit libkdecore-data usr/share/kde4/services
	Fsplit libkdecore-data usr/share/kde4/servicetypes
	Fsplit libkdecore-data usr/share/apps/LICENSES
	Fsplit libkdecore-data etc/kde/config/colors
	Fsplit libkdecore-data etc/xdg/menus
	Fsplit libkdecore-data usr/share/man

	## now split the rest to libkdecore
	Fsplit libkdecore /\*

	KDE_install
}

# optimization OK

